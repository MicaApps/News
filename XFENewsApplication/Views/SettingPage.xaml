<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="PDDShopManagementSystem.ClientApplication.Views.SettingPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:PDDShopManagementSystem.ClientApplication.Views"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:converter="using:PDDShopManagementSystem.ClientApplication.Utilities.Converter"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">
    <Page.Resources>
        <converter:StringFormatConverter x:Key="StringFormatConverter"/>
        <Style x:Key="SettingsSectionHeaderTextBlockStyle"
               BasedOn="{StaticResource BodyStrongTextBlockStyle}"
               TargetType="TextBlock">
            <Style.Setters>
                <Setter Property="Margin" Value="1,30,0,6" />
            </Style.Setters>
        </Style>
    </Page.Resources>

    <Grid>
        <ContentDialog x:Name="orderFarmingRatioSettingContentDialog" Title="设置用户实付金额比例" IsPrimaryButtonEnabled="True" IsSecondaryButtonEnabled="True" PrimaryButtonText="确定" SecondaryButtonText="取消" DefaultButton="Primary">
            <NumberBox PlaceholderText="输入用户实付金额比例（0% ~ 100%）" Value="{x:Bind ViewModel.OrderFarmingRatio, Mode=TwoWay}" SpinButtonPlacementMode="Inline"/>
        </ContentDialog>
        <ContentDialog x:Name="orderFarmingCountSettingContentDialog" Title="设置单笔订单数量" IsPrimaryButtonEnabled="True" IsSecondaryButtonEnabled="True" PrimaryButtonText="确定" SecondaryButtonText="取消" DefaultButton="Primary">
            <NumberBox PlaceholderText="输入单笔订单数量" Value="{x:Bind ViewModel.OrderFarmingCount, Mode=TwoWay}" SpinButtonPlacementMode="Inline"/>
        </ContentDialog>
        <ContentDialog x:Name="orderFarmingStartValueSettingContentDialog" Title="设置实收金额" IsPrimaryButtonEnabled="True" IsSecondaryButtonEnabled="True" PrimaryButtonText="确定" SecondaryButtonText="取消" DefaultButton="Primary">
            <NumberBox PlaceholderText="输入实收金额" Value="{x:Bind ViewModel.OrderFarmingStartValue, Mode=TwoWay}" SpinButtonPlacementMode="Inline"/>
        </ContentDialog>
        <ContentDialog x:Name="cleanCacheContentDialog" Title="清除应用缓存" Content="是否清除应用的所有无关缓存文件（可以定期清理）" IsPrimaryButtonEnabled="True" IsSecondaryButtonEnabled="True" PrimaryButtonText="确定" SecondaryButtonText="取消" DefaultButton="Primary"/>
        <ScrollView>
            <StackPanel Orientation="Vertical" Spacing="4">
                <TextBlock Text="外观" Style="{StaticResource SettingsSectionHeaderTextBlockStyle}"/>
                <controls:SettingsCard Header="色彩模式" Description="软件显示的主题颜色">
                    <controls:SettingsCard.HeaderIcon>
                        <FontIcon Glyph="&#xE790;"/>
                    </controls:SettingsCard.HeaderIcon>
                    <ComboBox x:Name="appThemeComboBox" Tag="PDDShopManagementSystem.ClientApplication.Profiles.CrossVersionProfiles.SystemProfile.Theme">
                        <ComboBoxItem Content="浅色" Tag="Light"/>
                        <ComboBoxItem Content="深色" Tag="Dark"/>
                        <ComboBoxItem Content="跟随系统" Tag="Default"/>
                    </ComboBox>
                </controls:SettingsCard>
                <TextBlock Text="店铺" Style="{StaticResource SettingsSectionHeaderTextBlockStyle}"/>
                <controls:SettingsExpander Header="刷单判定" Description="自动判断某个订单是否是为刷单订单，并在结果中排除">
                    <ToggleSwitch x:Name="orderFarmingToggleSwitch" IsOn="{x:Bind ViewModel.UseOrderFarmingJudgement, Mode=TwoWay}"/>
                    <controls:SettingsExpander.Items>
                        <controls:SettingsCard Header="用户实付金额比例" Description="用户实付价格低于商品价格的该百分比则判定为刷单" IsEnabled="{Binding ElementName=orderFarmingToggleSwitch, Path=IsOn, Mode=OneWay}" IsClickEnabled="True" Command="{x:Bind ViewModel.SetOrderFarmingRatioCommand}">
                            <controls:SettingsCard.ActionIcon>
                                <FontIcon Glyph="&#xE974;"/>
                            </controls:SettingsCard.ActionIcon>
                            <TextBlock Text="{x:Bind ViewModel.OrderFarmingRatio, Mode=OneWay, Converter={StaticResource StringFormatConverter}, ConverterParameter='(0)%'}"/>
                        </controls:SettingsCard>
                        <controls:SettingsCard Header="单笔订单数量" Description="用户单笔订单的商品数量超过该值则判定为刷单" IsEnabled="{Binding ElementName=orderFarmingToggleSwitch, Path=IsOn, Mode=OneWay}" IsClickEnabled="True" Command="{x:Bind ViewModel.SetOrderFarmingCountCommand}">
                            <controls:SettingsCard.ActionIcon>
                                <FontIcon Glyph="&#xE974;"/>
                            </controls:SettingsCard.ActionIcon>
                            <TextBlock Text="{x:Bind ViewModel.OrderFarmingCount, Mode=OneWay, Converter={StaticResource StringFormatConverter}, ConverterParameter='(0)单'}"/>
                        </controls:SettingsCard>
                        <controls:SettingsCard Header="实收金额" Description="实收金额小于该金额则判定为刷单" IsEnabled="{Binding ElementName=orderFarmingToggleSwitch, Path=IsOn, Mode=OneWay}" IsClickEnabled="True" Command="{x:Bind ViewModel.SetOrderFarmingStartValueCommand}">
                            <controls:SettingsCard.ActionIcon>
                                <FontIcon Glyph="&#xE974;"/>
                            </controls:SettingsCard.ActionIcon>
                            <TextBlock Text="{x:Bind ViewModel.OrderFarmingStartValue, Mode=OneWay, Converter={StaticResource StringFormatConverter}, ConverterParameter='(0)元'}"/>
                        </controls:SettingsCard>
                    </controls:SettingsExpander.Items>
                </controls:SettingsExpander>
                <TextBlock Text="路径&amp;缓存" Style="{StaticResource SettingsSectionHeaderTextBlockStyle}"/>
                <controls:SettingsCard Header="导出路径" Description="设置报表导出的文件夹" IsClickEnabled="True" Command="{x:Bind ViewModel.SetExportDirectoryCommand}">
                    <controls:SettingsCard.ActionIcon>
                        <FontIcon Glyph="&#xE974;"/>
                    </controls:SettingsCard.ActionIcon>
                    <TextBlock Text="{x:Bind ViewModel.ExportDirectory, Mode=OneWay}"/>
                </controls:SettingsCard>
                <controls:SettingsCard Header="缓存目录" Description="{x:Bind ViewModel.AppCacheDirectory, Mode=OneWay}" IsClickEnabled="True"  Command="{x:Bind ViewModel.OpenPathCommand}" CommandParameter="{x:Bind ViewModel.AppCacheDirectory, Mode=OneWay}">
                    <controls:SettingsCard.ActionIcon>
                        <FontIcon Glyph="&#xE8A7;"/>
                    </controls:SettingsCard.ActionIcon>
                    <Grid ColumnSpacing="20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Style="{ThemeResource CaptionTextBlockStyle}" Text="{x:Bind ViewModel.AppCacheSize, Mode=OneWay}" VerticalAlignment="Center"/>
                        <Button Grid.Column="1" Content="清除缓存" Command="{x:Bind ViewModel.ClearCacheCommand}"/>
                    </Grid>
                </controls:SettingsCard>
                <controls:SettingsCard Header="店铺数据目录" Description="{x:Bind ViewModel.AppDataDirectory, Mode=OneWay}" IsClickEnabled="True"  Command="{x:Bind ViewModel.OpenPathCommand}" CommandParameter="{x:Bind ViewModel.AppDataDirectory, Mode=OneWay}">
                    <controls:SettingsCard.ActionIcon>
                        <FontIcon Glyph="&#xE8A7;"/>
                    </controls:SettingsCard.ActionIcon>
                    <TextBlock Style="{ThemeResource CaptionTextBlockStyle}" Text="{x:Bind ViewModel.AppDataSize, Mode=OneWay}" VerticalAlignment="Center"/>
                </controls:SettingsCard>
                <TextBlock Text="用户" Style="{StaticResource SettingsSectionHeaderTextBlockStyle}"/>
                <controls:SettingsCard Header="自动登录" Description="记住账号，下次打开软件自动登录">
                    <ToggleSwitch IsOn="{x:Bind ViewModel.AutoLogin, Mode=TwoWay}"/>
                </controls:SettingsCard>
            </StackPanel>
        </ScrollView>
    </Grid>
</Page>
